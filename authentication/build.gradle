apply plugin: 'pmd'
apply plugin: 'checkstyle'
apply plugin: 'com.github.spotbugs'
apply plugin: 'com.github.johnrengelman.shadow'


buildscript {
    repositories {
        jcenter()
        maven {
          url "https://plugins.gradle.org/m2/"
        }
    }
    dependencies {
        classpath 'com.github.jengelman.gradle.plugins:shadow:2.0.4'
        classpath "gradle.plugin.com.github.spotbugs:spotbugs-gradle-plugin:1.6.3"
    }
}

dependencies {
  implementation project(':shared')
}

assemble.dependsOn shadowJar

war {
  archiveName = "explorviz-${project.name}.${extension}"
}

jar {
  manifest {
    attributes(
      'Main-Class': 'net.explorviz.security.server.main.Main'
    )
  }
}

shadowJar {
  archiveName = "explorviz-${project.name}.${extension}"
}


// Tooling
pmd {
  // Clear the rule set first. 
  // Otherwise we would have a lot of additional rules in our rule set.
  ruleSets = []
  ruleSetFiles = files("../conf/pmd.xml")
  consoleOutput = false
  ignoreFailures = true
  toolVersion = "6.7.0"
}
    
checkstyle {
  configFile = file("../conf/checkstyle.xml")
  configProperties = [
    'config_loc': file('../conf')
  ]
  ignoreFailures = false
  maxWarnings = 0
  toolVersion = "8.12"
}

spotbugs {
  reportLevel = "low"
  effort = "max"
  ignoreFailures = true
  toolVersion = '3.1.7'
}

// Embedded Webserver
gretty {
  httpPort = 8082
  servletContainer = 'jetty9'
  contextPath = '/'
  recompileOnSourceChange = false
  reloadOnClassChange = false
  reloadOnConfigChange = false
  reloadOnLibChange = false
}
